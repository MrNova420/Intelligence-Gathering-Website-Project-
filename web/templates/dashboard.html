{% extends "base.html" %}
{% block title %}Dashboard - Intelligence Platform{% endblock %}

{% block content %}
<!-- Advanced System Status Alert -->
<div class="alert alert-success holographic-panel fade show animate-slide-up" role="alert" style="border: 1px solid var(--holo-cyan);">
    <div class="d-flex align-items-center">
        <i class="fas fa-shield-check me-3 text-success pulse"></i>
        <div>
            <strong class="holo-text-glow">System Status:</strong>
            All systems operational | 
            <span class="badge ms-2" style="background: var(--gradient-quantum);">Uptime: 99.9%</span>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
</div>

<!-- Dashboard Header with Holographic Elements -->
<div class="row mb-4 animate-slide-up" style="animation-delay: 0.2s;">
    <div class="col-md-8">
        <h1 class="holo-text text-gradient mb-2" data-text="Intelligence Dashboard">
            <i class="fas fa-brain me-3" style="color: var(--quantum-primary);"></i>
            Intelligence Dashboard
        </h1>
        <p class="text-muted lead">Real-time monitoring and analytics powered by advanced AI</p>
    </div>
    <div class="col-md-4 text-end">
        <div class="btn-group" role="group">
            <button type="button" class="btn quantum-button magnetic-element" onclick="refreshDashboard()">
                <i class="fas fa-sync-alt me-2"></i>Refresh
            </button>
            <button type="button" class="btn quantum-button magnetic-element" onclick="startQuickScan()">
                <i class="fas fa-search me-2"></i>Quick Scan
            </button>
        </div>
    </div>
</div>

<!-- Advanced Metrics Grid with Neural Network Cards -->
<div class="row mb-5 intelligence-grid animate-slide-up" style="animation-delay: 0.3s;">
    <!-- System Health Metric -->
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="neural-card intelligence-cell magnetic-element" data-metric="system_health">
            <div class="d-flex align-items-center justify-content-between mb-2">
                <h6 class="holo-text-glow mb-0">
                    <i class="fas fa-heartbeat me-2 text-success"></i>System Health
                </h6>
                <div class="quantum-spinner-small"></div>
            </div>
            <h3 class="holo-text mb-1" data-text="Healthy">Healthy</h3>
            <small class="text-muted">
                <i class="fas fa-arrow-up text-success me-1"></i>
                99.9% uptime
            </small>
        </div>
    </div>

    <!-- Active Scanners Metric -->
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="neural-card intelligence-cell magnetic-element" data-metric="active_scanners">
            <div class="d-flex align-items-center justify-content-between mb-2">
                <h6 class="holo-text-glow mb-0">
                    <i class="fas fa-radar me-2 text-blue-400"></i>Active Scanners
                </h6>
                <span class="badge" style="background: var(--gradient-quantum);">Live</span>
            </div>
            <h3 class="holo-text mb-1" data-text="12">12</h3>
            <small class="text-muted">
                <i class="fas fa-plug text-primary me-1"></i>
                modules available
            </small>
        </div>
    </div>

    <!-- Total Scans Metric -->
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="neural-card intelligence-cell magnetic-element" data-metric="total_scans">
            <div class="d-flex align-items-center justify-content-between mb-2">
                <h6 class="holo-text-glow mb-0">
                    <i class="fas fa-search me-2 text-purple-400"></i>Total Scans
                </h6>
                <i class="fas fa-trending-up text-success"></i>
            </div>
            <h3 class="holo-text mb-1" data-text="1247">1,247</h3>
            <small class="text-success">
                <i class="fas fa-plus me-1"></i>
                +15 today
            </small>
        </div>
    </div>

    <!-- Success Rate Metric -->
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="neural-card intelligence-cell magnetic-element" data-metric="success_rate">
            <div class="d-flex align-items-center justify-content-between mb-2">
                <h6 class="holo-text-glow mb-0">
                    <i class="fas fa-target me-2 text-green-400"></i>Success Rate
                </h6>
                <div class="progress" style="width: 40px; height: 4px;">
                    <div class="progress-bar" style="width: 96%; background: var(--gradient-quantum);"></div>
                </div>
            </div>
            <h3 class="holo-text mb-1" data-text="96.1%">96.1%</h3>
            <small class="text-muted">accuracy rate</small>
        </div>
    </div>
</div>

<!-- Advanced Dashboard Content Grid -->
<div class="row">
    <!-- Scan Performance Chart -->
    <div class="col-lg-8 mb-4">
        <div class="holographic-panel p-4 magnetic-element animate-slide-up" style="animation-delay: 0.4s;">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <h5 class="holo-text-glow mb-0">
                    <i class="fas fa-chart-line me-2"></i>Scan Performance
                </h5>
                <div class="btn-group btn-group-sm" role="group">
                    <input type="radio" class="btn-check" name="timeRange" id="time24h" autocomplete="off" checked>
                    <label class="btn btn-outline-primary" for="time24h">24h</label>
                    
                    <input type="radio" class="btn-check" name="timeRange" id="time7d" autocomplete="off">
                    <label class="btn btn-outline-primary" for="time7d">7d</label>
                    
                    <input type="radio" class="btn-check" name="timeRange" id="time30d" autocomplete="off">
                    <label class="btn btn-outline-primary" for="time30d">30d</label>
                </div>
            </div>
            
            <!-- Advanced Chart Container -->
            <div class="chart-container" data-chart="performance" style="height: 300px; position: relative;">
                <canvas id="performanceChart" style="width: 100%; height: 100%;"></canvas>
                
                <!-- Holographic Chart Overlay -->
                <div class="chart-overlay" style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(45deg, transparent 49%, rgba(0, 255, 255, 0.02) 50%, transparent 51%);
                    background-size: 20px 20px;
                    pointer-events: none;
                "></div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Panel -->
    <div class="col-lg-4 mb-4">
        <div class="holographic-panel p-4 magnetic-element animate-slide-up" style="animation-delay: 0.5s;">
            <h5 class="holo-text-glow mb-3">
                <i class="fas fa-bolt me-2"></i>Quick Actions
            </h5>
            
            <div class="d-grid gap-3">
                <!-- Intelligence Scan Options -->
                <div class="row g-2">
                    <div class="col-6">
                        <a href="/scan?type=email" class="btn quantum-button w-100 magnetic-element" style="padding: 12px;">
                            <i class="fas fa-envelope d-block mb-1"></i>
                            <small>Email Investigation</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="/scan?type=phone" class="btn quantum-button w-100 magnetic-element" style="padding: 12px;">
                            <i class="fas fa-phone d-block mb-1"></i>
                            <small>Phone Lookup</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="/scan?type=domain" class="btn quantum-button w-100 magnetic-element" style="padding: 12px;">
                            <i class="fas fa-globe d-block mb-1"></i>
                            <small>Domain Analysis</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="/scan?type=social" class="btn quantum-button w-100 magnetic-element" style="padding: 12px;">
                            <i class="fas fa-users d-block mb-1"></i>
                            <small>Social Media</small>
                        </a>
                    </div>
                </div>
                
                <hr style="border-color: var(--neural-connection);">
                
                <!-- Advanced Tools -->
                <div class="text-center">
                    <h6 class="holo-text-glow small">Advanced Tools</h6>
                    <div class="d-grid gap-2">
                        <a href="/batch-scan" class="btn btn-outline-primary magnetic-element">
                            <i class="fas fa-layer-group me-2"></i>Batch Scan
                        </a>
                        <a href="/api/v1/scan" class="btn btn-outline-secondary magnetic-element">
                            <i class="fas fa-code me-2"></i>API
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity and Intelligence Feed -->
<div class="row">
    <!-- Recent Activity -->
    <div class="col-lg-6 mb-4">
        <div class="holographic-panel p-4 magnetic-element animate-slide-up" style="animation-delay: 0.6s;">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <h5 class="holo-text-glow mb-0">
                    <i class="fas fa-history me-2"></i>Recent Activity
                </h5>
                <a href="/reports" class="btn btn-outline-primary btn-sm magnetic-element">
                    <i class="fas fa-external-link-alt me-1"></i>View All
                </a>
            </div>
            
            <div id="recentActivity" class="activity-feed">
                <!-- Activity will be populated by JavaScript -->
                <div class="text-center py-4">
                    <div class="neural-card p-3">
                        <i class="fas fa-search fa-2x text-muted mb-2"></i>
                        <h6 class="text-muted">No recent scans</h6>
                        <p class="text-muted small mb-3">Start your first intelligence gathering scan</p>
                        <a href="/scan" class="btn quantum-button magnetic-element">
                            <i class="fas fa-play me-2"></i>Start First Scan
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scan Distribution Chart -->
    <div class="col-lg-6 mb-4">
        <div class="holographic-panel p-4 magnetic-element animate-slide-up" style="animation-delay: 0.7s;">
            <h5 class="holo-text-glow mb-3">
                <i class="fas fa-chart-pie me-2"></i>Scan Distribution
            </h5>
            
            <div class="chart-container" data-chart="distribution" style="height: 200px;">
                <!-- Distribution Chart will be rendered here -->
                <div class="distribution-stats">
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="neural-card p-2">
                                <div class="d-flex align-items-center justify-content-center mb-1">
                                    <div class="legend-color me-2" style="width: 12px; height: 12px; background: var(--holo-blue); border-radius: 50%;"></div>
                                    <small class="text-muted">Email</small>
                                </div>
                                <strong class="holo-text" data-text="45%">45%</strong>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="neural-card p-2">
                                <div class="d-flex align-items-center justify-content-center mb-1">
                                    <div class="legend-color me-2" style="width: 12px; height: 12px; background: var(--holo-green); border-radius: 50%;"></div>
                                    <small class="text-muted">Phone</small>
                                </div>
                                <strong class="holo-text" data-text="30%">30%</strong>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="neural-card p-2">
                                <div class="d-flex align-items-center justify-content-center mb-1">
                                    <div class="legend-color me-2" style="width: 12px; height: 12px; background: var(--holo-purple); border-radius: 50%;"></div>
                                    <small class="text-muted">Social</small>
                                </div>
                                <strong class="holo-text" data-text="15%">15%</strong>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="neural-card p-2">
                                <div class="d-flex align-items-center justify-content-center mb-1">
                                    <div class="legend-color me-2" style="width: 12px; height: 12px; background: var(--holo-orange); border-radius: 50%;"></div>
                                    <small class="text-muted">Domain</small>
                                </div>
                                <strong class="holo-text" data-text="10%">10%</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Real-time Intelligence Feed (Advanced Feature) -->
<div class="row">
    <div class="col-12">
        <div class="holographic-panel p-4 magnetic-element animate-slide-up" style="animation-delay: 0.8s;">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <h5 class="holo-text-glow mb-0">
                    <i class="fas fa-satellite-dish me-2 pulse"></i>Live Intelligence Feed
                </h5>
                <div class="d-flex align-items-center">
                    <span class="badge me-2" style="background: var(--gradient-quantum);">Real-time</span>
                    <div class="quantum-spinner-small"></div>
                </div>
            </div>
            
            <div id="intelligenceFeed" class="intelligence-feed">
                <!-- Live feed will be populated by JavaScript -->
                <div class="feed-item animate-slide-right" style="animation-delay: 1s;">
                    <div class="d-flex align-items-start">
                        <div class="feed-icon me-3">
                            <i class="fas fa-shield-alt text-warning"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center justify-content-between">
                                <small class="text-muted">2 minutes ago</small>
                                <span class="badge badge-warning">Medium Priority</span>
                            </div>
                            <p class="mb-1 holo-text-glow">Suspicious domain registered: malware-c2.com</p>
                            <small class="text-muted">Automated threat detection • 3 sources confirmed</small>
                        </div>
                    </div>
                </div>
                
                <div class="feed-item animate-slide-right" style="animation-delay: 1.2s;">
                    <div class="d-flex align-items-start">
                        <div class="feed-icon me-3">
                            <i class="fas fa-user-friends text-info"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center justify-content-between">
                                <small class="text-muted">5 minutes ago</small>
                                <span class="badge badge-info">Information</span>
                            </div>
                            <p class="mb-1 holo-text-glow">New social media profile linked to target entity</p>
                            <small class="text-muted">Cross-platform correlation • 94.7% confidence</small>
                        </div>
                    </div>
                </div>
                
                <div class="feed-item animate-slide-right" style="animation-delay: 1.4s;">
                    <div class="d-flex align-items-start">
                        <div class="feed-icon me-3">
                            <i class="fas fa-check-circle text-success"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center justify-content-between">
                                <small class="text-muted">8 minutes ago</small>
                                <span class="badge badge-success">Completed</span>
                            </div>
                            <p class="mb-1 holo-text-glow">Email validation completed: 94.7% confidence</p>
                            <small class="text-muted">Advanced verification • Multiple providers validated</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Additional Dashboard-specific Styles */
    .pulse {
        animation: pulseGlow 2s infinite;
    }
    
    @keyframes pulseGlow {
        0%, 100% { 
            opacity: 1;
            text-shadow: 0 0 5px currentColor;
        }
        50% { 
            opacity: 0.7;
            text-shadow: 0 0 20px currentColor;
        }
    }
    
    .quantum-spinner-small {
        width: 20px;
        height: 20px;
        border: 2px solid transparent;
        border-top: 2px solid var(--quantum-primary);
        border-radius: 50%;
        animation: quantumSpin 1s linear infinite;
    }
    
    .activity-feed .feed-item {
        padding: 15px;
        border-left: 3px solid var(--neural-connection);
        margin-bottom: 15px;
        background: rgba(0, 50, 100, 0.1);
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .activity-feed .feed-item:hover {
        border-left-color: var(--quantum-primary);
        background: rgba(0, 255, 255, 0.05);
        transform: translateX(5px);
    }
    
    .intelligence-feed .feed-item {
        padding: 12px;
        border-bottom: 1px solid var(--neural-connection);
        transition: all 0.3s ease;
    }
    
    .intelligence-feed .feed-item:hover {
        background: rgba(0, 255, 255, 0.05);
    }
    
    .feed-icon {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: rgba(0, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--neural-connection);
    }
    
    .legend-color {
        animation: var(--animation-neural-pulse);
    }
    
    .distribution-stats .neural-card:hover {
        transform: scale(1.05);
        border-color: var(--quantum-primary);
    }
    
    /* Metric Cards Enhancements */
    .intelligence-cell[data-metric="system_health"]:hover {
        border-color: var(--holo-green);
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    }
    
    .intelligence-cell[data-metric="active_scanners"]:hover {
        border-color: var(--holo-blue);
        box-shadow: 0 0 20px rgba(0, 153, 255, 0.3);
    }
    
    .intelligence-cell[data-metric="total_scans"]:hover {
        border-color: var(--holo-purple);
        box-shadow: 0 0 20px rgba(153, 0, 255, 0.3);
    }
    
    .intelligence-cell[data-metric="success_rate"]:hover {
        border-color: var(--holo-green);
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Advanced Dashboard Management System
    class AdvancedDashboard {
        constructor() {
            this.metrics = new Map();
            this.charts = new Map();
            this.realTimeUpdates = true;
            this.init();
        }
        
        init() {
            this.initializeCharts();
            this.startRealTimeUpdates();
            this.setupInteractivity();
            this.initializeIntelligenceFeed();
        }
        
        initializeCharts() {
            // Initialize performance chart if Chart.js is available
            if (typeof Chart !== 'undefined') {
                this.createPerformanceChart();
                this.createDistributionChart();
            } else {
                console.log('📊 Chart.js not loaded, using fallback visualizations');
                this.createFallbackCharts();
            }
        }
        
        createPerformanceChart() {
            const ctx = document.getElementById('performanceChart');
            if (!ctx) return;
            
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: this.generateTimeLabels(),
                    datasets: [{
                        label: 'Scans per Hour',
                        data: this.generatePerformanceData(),
                        borderColor: 'rgb(0, 255, 255)',
                        backgroundColor: 'rgba(0, 255, 255, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#64748b' },
                            grid: { color: 'rgba(100, 116, 139, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#64748b' },
                            grid: { color: 'rgba(100, 116, 139, 0.1)' }
                        }
                    }
                }
            });
            
            this.charts.set('performance', chart);
        }
        
        createFallbackCharts() {
            // Create animated SVG visualizations as fallback
            this.createSVGPerformanceChart();
        }
        
        createSVGPerformanceChart() {
            const container = document.querySelector('.chart-container[data-chart="performance"]');
            if (!container) return;
            
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.innerHTML = `
                <defs>
                    <linearGradient id="chartGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:rgba(0,255,255,0.8);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:rgba(0,255,255,0.1);stop-opacity:1" />
                    </linearGradient>
                </defs>
                <path d="M 0,200 Q 50,150 100,100 T 200,80 T 300,120 T 400,60 L 400,200 Z" 
                      fill="url(#chartGradient)" stroke="rgb(0,255,255)" stroke-width="2">
                    <animate attributeName="d" 
                             values="M 0,200 Q 50,150 100,100 T 200,80 T 300,120 T 400,60 L 400,200 Z;
                                     M 0,200 Q 50,180 100,120 T 200,100 T 300,90 T 400,70 L 400,200 Z;
                                     M 0,200 Q 50,150 100,100 T 200,80 T 300,120 T 400,60 L 400,200 Z"
                             dur="4s" repeatCount="indefinite"/>
                </path>
            `;
            
            container.appendChild(svg);
        }
        
        generateTimeLabels() {
            const labels = [];
            const now = new Date();
            for (let i = 23; i >= 0; i--) {
                const time = new Date(now - i * 60 * 60 * 1000);
                labels.push(time.getHours() + ':00');
            }
            return labels;
        }
        
        generatePerformanceData() {
            return Array.from({length: 24}, () => Math.floor(Math.random() * 50) + 20);
        }
        
        startRealTimeUpdates() {
            // Simulate real-time metric updates
            setInterval(() => {
                this.updateMetrics();
                this.updateIntelligenceFeed();
            }, 5000);
        }
        
        updateMetrics() {
            const metrics = [
                { selector: '[data-metric="total_scans"] h3', value: this.generateRandomMetric(1200, 1300) },
                { selector: '[data-metric="success_rate"] h3', value: (95 + Math.random() * 3).toFixed(1) + '%' },
                { selector: '[data-metric="active_scanners"] h3', value: Math.floor(Math.random() * 3) + 10 }
            ];
            
            metrics.forEach(metric => {
                const element = document.querySelector(metric.selector);
                if (element) {
                    this.animateMetricUpdate(element, metric.value);
                }
            });
        }
        
        animateMetricUpdate(element, newValue) {
            element.style.transform = 'scale(1.1)';
            element.style.color = 'var(--quantum-primary)';
            
            setTimeout(() => {
                element.textContent = newValue;
                element.style.transform = '';
                element.style.color = '';
            }, 300);
        }
        
        generateRandomMetric(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        initializeIntelligenceFeed() {
            // Add more intelligence feed items periodically
            setTimeout(() => {
                this.addIntelligenceFeedItem({
                    icon: 'fas fa-phone text-primary',
                    time: 'Just now',
                    priority: 'Info',
                    message: 'Phone number verified in 12 countries',
                    details: 'Global carrier validation • High confidence match'
                });
            }, 3000);
        }
        
        addIntelligenceFeedItem(item) {
            const feed = document.getElementById('intelligenceFeed');
            if (!feed) return;
            
            const feedItem = document.createElement('div');
            feedItem.className = 'feed-item animate-slide-right';
            feedItem.innerHTML = `
                <div class="d-flex align-items-start">
                    <div class="feed-icon me-3">
                        <i class="${item.icon}"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div class="d-flex align-items-center justify-content-between">
                            <small class="text-muted">${item.time}</small>
                            <span class="badge badge-${item.priority.toLowerCase()}">${item.priority}</span>
                        </div>
                        <p class="mb-1 holo-text-glow">${item.message}</p>
                        <small class="text-muted">${item.details}</small>
                    </div>
                </div>
            `;
            
            feed.insertBefore(feedItem, feed.firstChild);
            
            // Remove old items to prevent overflow
            const items = feed.querySelectorAll('.feed-item');
            if (items.length > 5) {
                items[items.length - 1].remove();
            }
        }
        
        updateIntelligenceFeed() {
            const feedItems = [
                {
                    icon: 'fas fa-globe text-warning',
                    time: 'Just now',
                    priority: 'Medium',
                    message: 'OSINT scan completed: 47 new data points',
                    details: 'Multi-source aggregation • Pattern analysis complete'
                },
                {
                    icon: 'fas fa-shield-alt text-success',
                    time: '1 minute ago',
                    priority: 'Low',
                    message: 'Security validation passed for target domain',
                    details: 'SSL certificate verified • No malicious indicators'
                }
            ];
            
            const randomItem = feedItems[Math.floor(Math.random() * feedItems.length)];
            this.addIntelligenceFeedItem(randomItem);
        }
        
        setupInteractivity() {
            // Add hover effects to charts
            document.querySelectorAll('.chart-container').forEach(container => {
                container.addEventListener('mouseenter', () => {
                    container.style.transform = 'scale(1.02)';
                });
                
                container.addEventListener('mouseleave', () => {
                    container.style.transform = '';
                });
            });
            
            // Setup time range toggle
            document.querySelectorAll('input[name="timeRange"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    this.updateChartTimeRange(e.target.id);
                });
            });
        }
        
        updateChartTimeRange(range) {
            console.log(`📊 Updating chart time range: ${range}`);
            // Update chart data based on selected time range
            const chart = this.charts.get('performance');
            if (chart) {
                chart.data.labels = this.generateTimeLabels(range);
                chart.data.datasets[0].data = this.generatePerformanceData();
                chart.update('active');
            }
        }
    }
    
    // Global functions for button actions
    window.refreshDashboard = function() {
        console.log('🔄 Refreshing dashboard...');
        
        if (window.advancedPlatform && window.advancedPlatform.advancedUI) {
            window.advancedPlatform.advancedUI.createContextualMenu(
                window.innerWidth / 2,
                window.innerHeight / 2,
                [
                    { label: '🔄 Refresh All Data', action: () => location.reload() },
                    { label: '📊 Update Charts', action: () => dashboard.updateMetrics() },
                    { label: '🔍 Restart Scanners', action: () => console.log('Scanners restarted') }
                ]
            );
        } else {
            // Fallback refresh
            location.reload();
        }
    };
    
    window.startQuickScan = function() {
        console.log('⚡ Starting quick scan...');
        window.location.href = '/scan';
    };
    
    // Initialize advanced dashboard
    let dashboard;
    document.addEventListener('DOMContentLoaded', () => {
        dashboard = new AdvancedDashboard();
        
        // Show initialization complete message
        if (window.advancedPlatform) {
            setTimeout(() => {
                window.advancedPlatform.showSystemStatusHologram();
            }, 2000);
        }
    });
</script>
{% endblock %}