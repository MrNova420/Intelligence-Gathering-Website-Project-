{% extends "base.html" %}
{% block title %}Scan Results - Intelligence Platform{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1 class="d-flex align-items-center mb-2">
            <i class="fas fa-search-plus me-3 text-primary"></i>
            Scan Results
        </h1>
        <p class="text-muted mb-0">Comprehensive intelligence analysis for scan ID: <code>{{ scan_id }}</code></p>
    </div>
    <div class="col-md-4 text-end">
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-primary" onclick="exportResults('pdf')">
                <i class="fas fa-file-pdf me-1"></i>Export PDF
            </button>
            <button type="button" class="btn btn-outline-success" onclick="exportResults('json')">
                <i class="fas fa-file-code me-1"></i>Export JSON
            </button>
            <button type="button" class="btn btn-outline-info" onclick="shareResults()">
                <i class="fas fa-share me-1"></i>Share
            </button>
        </div>
    </div>
</div>

<!-- Scan Overview Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card border-0 shadow-sm text-center">
            <div class="card-body">
                <div class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <i class="fas fa-check fa-2x text-success"></i>
                </div>
                <h6 class="text-muted mb-1">Scan Status</h6>
                <h4 class="text-success mb-0">Completed</h4>
                <small class="text-muted">{{ datetime.now().strftime('%Y-%m-%d %H:%M') }}</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm text-center">
            <div class="card-body">
                <div class="bg-info bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <i class="fas fa-database fa-2x text-info"></i>
                </div>
                <h6 class="text-muted mb-1">Data Sources</h6>
                <h4 class="text-info mb-0">12</h4>
                <small class="text-muted">scanners utilized</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm text-center">
            <div class="card-body">
                <div class="bg-warning bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <i class="fas fa-chart-line fa-2x text-warning"></i>
                </div>
                <h6 class="text-muted mb-1">Confidence Score</h6>
                <h4 class="text-warning mb-0">87%</h4>
                <div class="progress" style="height: 4px;">
                    <div class="progress-bar bg-warning" style="width: 87%"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm text-center">
            <div class="card-body">
                <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <i class="fas fa-clock fa-2x text-primary"></i>
                </div>
                <h6 class="text-muted mb-1">Execution Time</h6>
                <h4 class="text-primary mb-0">2.3s</h4>
                <small class="text-muted">average response</small>
            </div>
        </div>
    </div>
</div>

<!-- Results Analysis -->
<div class="row">
    <!-- Main Results -->
    <div class="col-lg-8 mb-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-analytics me-2"></i>Intelligence Findings</h5>
                <div class="btn-group btn-group-sm" role="group">
                    <button type="button" class="btn btn-outline-primary active" data-results-view="detailed">Detailed</button>
                    <button type="button" class="btn btn-outline-primary" data-results-view="summary">Summary</button>
                    <button type="button" class="btn btn-outline-primary" data-results-view="raw">Raw Data</button>
                </div>
            </div>
            <div class="card-body">
                <div id="results-detailed" class="results-view">
                    <!-- Email Information -->
                    <div class="result-section mb-4">
                        <h6 class="result-section-title">
                            <i class="fas fa-envelope text-primary me-2"></i>
                            Email Analysis
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="result-item">
                                    <span class="result-label">Email Address:</span>
                                    <span class="result-value font-monospace">example@domain.com</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Domain:</span>
                                    <span class="result-value">domain.com</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Validation Status:</span>
                                    <span class="badge bg-success">Valid</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="result-item">
                                    <span class="result-label">Provider:</span>
                                    <span class="result-value">Google Workspace</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Security Score:</span>
                                    <span class="result-value">8.5/10</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Breach History:</span>
                                    <span class="badge bg-warning">2 incidents</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Social Media Presence -->
                    <div class="result-section mb-4">
                        <h6 class="result-section-title">
                            <i class="fas fa-users text-info me-2"></i>
                            Social Media Presence
                        </h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="social-platform-card">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fab fa-linkedin text-primary me-2"></i>
                                        <strong>LinkedIn</strong>
                                        <span class="badge bg-success ms-auto">Found</span>
                                    </div>
                                    <small class="text-muted">Professional profile with 500+ connections</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="social-platform-card">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fab fa-twitter text-info me-2"></i>
                                        <strong>Twitter</strong>
                                        <span class="badge bg-success ms-auto">Found</span>
                                    </div>
                                    <small class="text-muted">Active user, 1.2K followers</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="social-platform-card">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fab fa-github text-dark me-2"></i>
                                        <strong>GitHub</strong>
                                        <span class="badge bg-success ms-auto">Found</span>
                                    </div>
                                    <small class="text-muted">15 repositories, 89 stars</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Domain Information -->
                    <div class="result-section mb-4">
                        <h6 class="result-section-title">
                            <i class="fas fa-globe text-success me-2"></i>
                            Domain Intelligence
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="result-item">
                                    <span class="result-label">Domain Age:</span>
                                    <span class="result-value">8 years, 3 months</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Registrar:</span>
                                    <span class="result-value">GoDaddy</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">SSL Certificate:</span>
                                    <span class="badge bg-success">Valid</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="result-item">
                                    <span class="result-label">DNS Records:</span>
                                    <span class="result-value">A, MX, TXT verified</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Reputation:</span>
                                    <span class="badge bg-success">Clean</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Blacklist Status:</span>
                                    <span class="badge bg-success">Not Listed</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="results-summary" class="results-view d-none">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle me-2"></i>Executive Summary</h6>
                        <p class="mb-2">The target email address appears to belong to a legitimate professional user with an established online presence. No significant security concerns were identified.</p>
                        <ul class="mb-0">
                            <li>✅ Email address is valid and active</li>
                            <li>✅ Associated with professional social media profiles</li>
                            <li>⚠️ Found in 2 historical data breaches (low risk)</li>
                            <li>✅ Domain has clean reputation and valid SSL</li>
                        </ul>
                    </div>
                </div>
                
                <div id="results-raw" class="results-view d-none">
                    <pre class="bg-light p-3 rounded"><code>{
  "scan_id": "{{ scan_id }}",
  "timestamp": "{{ datetime.now().isoformat() }}",
  "target": "example@domain.com",
  "scanners_used": ["email_validator", "breach_checker", "social_media", "domain_analyzer"],
  "results": {
    "email_validation": {
      "valid": true,
      "deliverable": true,
      "disposable": false,
      "mx_records": true
    },
    "social_media": {
      "linkedin": {"found": true, "url": "https://linkedin.com/in/..."},
      "twitter": {"found": true, "followers": 1200},
      "github": {"found": true, "repos": 15}
    },
    "domain_info": {
      "age_years": 8.25,
      "ssl_valid": true,
      "reputation": "clean"
    }
  }
}</code></pre>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Risk Assessment & Actions -->
    <div class="col-lg-4 mb-4">
        <!-- Risk Assessment -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-transparent border-0">
                <h6 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Risk Assessment</h6>
            </div>
            <div class="card-body">
                <div class="risk-meter mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Overall Risk</span>
                        <span class="badge bg-success">Low</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-success" style="width: 25%"></div>
                    </div>
                </div>
                
                <div class="risk-factors">
                    <div class="risk-factor d-flex justify-content-between align-items-center mb-2">
                        <span class="small">Legitimacy</span>
                        <span class="badge bg-success-subtle text-success">High</span>
                    </div>
                    <div class="risk-factor d-flex justify-content-between align-items-center mb-2">
                        <span class="small">Privacy</span>
                        <span class="badge bg-warning-subtle text-warning">Medium</span>
                    </div>
                    <div class="risk-factor d-flex justify-content-between align-items-center mb-2">
                        <span class="small">Security</span>
                        <span class="badge bg-success-subtle text-success">High</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-transparent border-0">
                <h6 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary btn-sm" onclick="deepScan()">
                        <i class="fas fa-search-plus me-2"></i>Deep Scan
                    </button>
                    <button class="btn btn-outline-info btn-sm" onclick="monitorTarget()">
                        <i class="fas fa-eye me-2"></i>Monitor Changes
                    </button>
                    <button class="btn btn-outline-warning btn-sm" onclick="flagForReview()">
                        <i class="fas fa-flag me-2"></i>Flag for Review
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="saveToWorkspace()">
                        <i class="fas fa-bookmark me-2"></i>Save to Workspace
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Scan Timeline -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-transparent border-0">
                <h6 class="mb-0"><i class="fas fa-history me-2"></i>Scan Timeline</h6>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-marker bg-primary"></div>
                        <div class="timeline-content">
                            <small class="text-muted">Just now</small>
                            <div class="small">Scan completed successfully</div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-info"></div>
                        <div class="timeline-content">
                            <small class="text-muted">2 seconds ago</small>
                            <div class="small">Social media analysis finished</div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-warning"></div>
                        <div class="timeline-content">
                            <small class="text-muted">5 seconds ago</small>
                            <div class="small">Domain information retrieved</div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-success"></div>
                        <div class="timeline-content">
                            <small class="text-muted">8 seconds ago</small>
                            <div class="small">Email validation completed</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.result-section {
    border-left: 4px solid var(--bs-primary);
    padding-left: 1rem;
    margin-left: 0.5rem;
}

.result-section-title {
    color: var(--bs-primary);
    margin-bottom: 1rem;
    font-weight: 600;
}

.result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.result-label {
    font-weight: 500;
    color: var(--bs-secondary);
}

.result-value {
    font-weight: 600;
}

.social-platform-card {
    padding: 1rem;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 8px;
    margin-bottom: 1rem;
}

.timeline {
    position: relative;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 8px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--bs-border-color);
}

.timeline-item {
    position: relative;
    padding-left: 2rem;
    margin-bottom: 1rem;
}

.timeline-marker {
    position: absolute;
    left: 0;
    top: 0.25rem;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 0 0 2px var(--bs-border-color);
}

.risk-meter .progress {
    border-radius: 10px;
}
</style>

<script>
// Results view switching
document.querySelectorAll('[data-results-view]').forEach(button => {
    button.addEventListener('click', function() {
        const view = this.dataset.resultsView;
        
        // Update active button
        document.querySelectorAll('[data-results-view]').forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        
        // Show/hide views
        document.querySelectorAll('.results-view').forEach(viewEl => {
            viewEl.classList.add('d-none');
        });
        document.getElementById(`results-${view}`).classList.remove('d-none');
    });
});

// Export functions
function exportResults(format) {
    // Implement export functionality
    console.log(`Exporting results in ${format} format`);
    showAlert('info', `Exporting results in ${format.toUpperCase()} format...`);
}

function shareResults() {
    // Implement sharing functionality
    if (navigator.share) {
        navigator.share({
            title: 'Intelligence Scan Results',
            text: 'Check out these intelligence scan results',
            url: window.location.href
        });
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(window.location.href);
        showAlert('success', 'Results URL copied to clipboard!');
    }
}

// Quick action functions
function deepScan() {
    showAlert('info', 'Initiating deep scan with additional scanners...');
}

function monitorTarget() {
    showAlert('success', 'Target added to monitoring watchlist');
}

function flagForReview() {
    showAlert('warning', 'Results flagged for manual review');
}

function saveToWorkspace() {
    showAlert('success', 'Results saved to your workspace');
}

// Alert helper function
function showAlert(type, message) {
    const alertsContainer = document.getElementById('alertsContainer');
    if (!alertsContainer) return;
    
    const alert = document.createElement('div');
    alert.className = `alert alert-${type} alert-dismissible fade show`;
    alert.innerHTML = `
        <i class="fas fa-info-circle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    alertsContainer.appendChild(alert);
    
    setTimeout(() => alert.remove(), 5000);
}
</script>
{% endblock %}